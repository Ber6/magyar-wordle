<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Lauder Wordle</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #121213;
      color: white;
      margin: 0;
      padding: 20px;
    }
    input[type="text"] {
      padding: 10px;
      font-size: 16px;
      margin: 5px;
      width: 200px;
      text-align: center;
      text-transform: lowercase;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 5px;
      cursor: pointer;
    }
    .board {
      display: grid;
      grid-template-columns: repeat(5, 60px);
      gap: 10px;
      justify-content: center;
      margin-top: 30px;
    }
    .tile {
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      font-weight: bold;
      border: 2px solid #3a3a3c;
      text-transform: uppercase;
    }
    .correct {
      background-color: #538d4e;
      border-color: #538d4e;
    }
    .present {
      background-color: #b59f3b;
      border-color: #b59f3b;
    }
    .absent {
      background-color: #3a3a3c;
      border-color: #3a3a3c;
    }
    #leaderboard {
      list-style: none;
      padding: 0;
      max-width: 400px;
      margin: 20px auto;
      text-align: left;
    }
  </style>
</head>
<body>

  <h1>Lauder Wordle</h1>

  <h2>Kérlek add meg a neved és osztályod:</h2>
  <input type="text" id="playerName" placeholder="Név">
  <input type="text" id="playerClass" placeholder="Osztály">
  <button onclick="startGame()">Start</button>
  <p id="setupMessage"></p>
  <hr style="margin-top: 20px;">

  <div class="board" id="board"></div>

  <input type="text" id="guessInput" maxlength="5" placeholder="Írj egy 5 betűs szót">
  <button onclick="makeGuess()">Tippel</button>
  <p id="message"></p>

  <h2>Toplista (Napi szó)</h2>
  <ul id="leaderboard"></ul>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyDyA43gRPMPbXV4UnXkWTzlxuLzyY5fQTY",
      authDomain: "lauder-wordle.firebaseapp.com",
      projectId: "lauder-wordle",
      storageBucket: "lauder-wordle.firebasestorage.app",
      messagingSenderId: "989182518286",
      appId: "1:989182518286:web:b56d40197beff94300085f",
      measurementId: "G-0MC26GFHTJ"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let words = [];
    let target = "";
    let attempts = 0;
    let player = null;

    const board = document.getElementById('board');
    const input = document.getElementById('guessInput');
    const message = document.getElementById('message');

    input.addEventListener("keypress", function (e) {
      if (e.key === "Enter") makeGuess();
    });

    function startGame() {
      const name = document.getElementById("playerName").value.trim();
      const osztaly = document.getElementById("playerClass").value.trim();
      const setupMsg = document.getElementById("setupMessage");

      if (!name || !osztaly) {
        setupMsg.textContent = "Kérlek, add meg a neved és osztályod!";
        return;
      }

      player = { name, osztaly };
      document.getElementById("playerName").disabled = true;
      document.getElementById("playerClass").disabled = true;
      setupMsg.innerHTML = `<strong>Jó játékot, ${name} (${osztaly})!</strong>`;
    }

    function getDailyIndex(len) {
      const today = new Date();
      const daysSinceEpoch = Math.floor(today.getTime() / (1000 * 60 * 60 * 24));
      return daysSinceEpoch % len;
    }

    function loadWordList() {
      fetch("magyar_latin2.txt")
        .then(response => response.text())
        .then(text => {
          words = text
            .split(/\r?\n/)
            .map(w => w.trim().toLowerCase())
            .filter(w => /^[a-záéíóöőúüű]{5}$/i.test(w));

          if (words.length === 0) {
            message.textContent = "Nem találtam érvényes 5 betűs szót.";
            return;
          }

          const index = getDailyIndex(words.length);
          target = words[index];
          console.log("Napi szó:", target); // DEBUG
          renderLeaderboard();
        })
        .catch(err => {
          console.error("Szólista betöltési hiba:", err);
          message.textContent = "Nem sikerült betölteni a szavakat.";
        });
    }

    function makeGuess() {
      if (!player) {
        message.textContent = "Előbb add meg a neved és osztályod!";
        return;
      }

      const guess = input.value.trim().toLowerCase();

      if (guess === "sos") {
        message.innerHTML = `A szó: <strong>${target}</strong>. Tippjeid száma: ${attempts}`;
        input.disabled = true;
        return;
      }

      if (guess.length !== 5) {
        message.textContent = "A szó nem 5 betűs.";
        return;
      }

      if (!words.includes(guess)) {
        message.textContent = "Ez a szó nincs az adatbázisban.";
        return;
      }

      const row = document.createElement("div");
      row.className = "row";
      row.style.display = "contents";

      const targetLetters = target.split('');
      const guessLetters = guess.split('');
      const result = Array(5).fill("absent");
      const used = Array(5).fill(false);

      for (let i = 0; i < 5; i++) {
        if (guessLetters[i] === targetLetters[i]) {
          result[i] = "correct";
          used[i] = true;
        }
      }

      for (let i = 0; i < 5; i++) {
        if (result[i] !== "correct") {
          for (let j = 0; j < 5; j++) {
            if (!used[j] && guessLetters[i] === targetLetters[j]) {
              result[i] = "present";
              used[j] = true;
              break;
            }
          }
        }
      }

      for (let i = 0; i < 5; i++) {
        const tile = document.createElement("div");
        tile.className = `tile ${result[i]}`;
        tile.textContent = guessLetters[i];
        row.appendChild(tile);
      }

      board.appendChild(row);
      attempts++;

      if (guess === target) {
        message.innerHTML = `<strong>Eltaláltad!</strong> Tippjeid száma: ${attempts}`;
        input.disabled = true;

        const entry = {
          name: player.name,
          osztaly: player.osztaly,
          tries: attempts,
          date: new Date().toISOString().slice(0, 10)
        };

        db.collection("lauder_wordle_scores").add(entry)
          .then(() => renderLeaderboard())
          .catch(err => {
            console.error("Mentési hiba:", err);
            message.textContent = "Nem sikerült elmenteni az eredményt.";
          });
      } else {
        message.textContent = "";
      }

      input.value = "";
      input.focus();
    }

    function renderLeaderboard() {
      const list = document.getElementById("leaderboard");
      const today = new Date().toISOString().slice(0, 10);

      db.collection("lauder_wordle_scores")
        .where("date", "==", today)
        .orderBy("tries")
        .limit(10)
        .get()
        .then(snapshot => {
          list.innerHTML = "";
          snapshot.forEach((doc, index) => {
            const entry = doc.data();
            const li = document.createElement("li");
            li.textContent = `${index + 1}. ${entry.name} (${entry.osztaly}) – ${entry.tries} próbálkozás`;
            list.appendChild(li);
          });
        })
        .catch(err => {
          console.error("Toplista betöltési hiba:", err);
        });
    }

    loadWordList();
  </script>
</body>
</html>
